<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>4x4 Custom Chess Game - Transparent</title>
    
    <style>
        /* 1. ‡§®‡•â‡§®-‡§ú‡§º‡•Ç‡§Æ‡•á‡§¨‡§≤ ‡§î‡§∞ ‡§®‡•â‡§®-‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤‡•á‡§¨‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è CSS */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤‡§ø‡§Ç‡§ó ‡§Ö‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç */
            height: 100%;
            width: 100%;
        }

        /* 2. ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡•Ä ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
        body {
            background-color: transparent !important; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 3. 1:1 ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ */
        #game-container {
            width: 100vw; 
            height: 100vw; 
            max-width: 100vh; 
            max-height: 100vh;
            box-sizing: border-box;
            padding: 1vmin; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            width: 100%;
            flex: 1; 
            border: none; /* ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡•Ç‡§∞‡§æ ‡§™‡•á‡§ú ‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡•Ä ‡§π‡•à */
        }

        .square {
            /* ‡§∏‡•á‡§≤ ‡§ï‡§æ ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡•Ä */
            background-color: transparent !important; 
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            user-select: none;
            box-sizing: border-box;
            border: 1px solid rgba(0, 0, 0, 0.1); /* ‡§π‡§≤‡•ç‡§ï‡§æ ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§ó‡•ç‡§∞‡§ø‡§° ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
        }

        /* ‡§ü‡•ã‡§ï‡§® ‡§á‡§Æ‡•á‡§ú ‡§ï‡§æ ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ */
        .piece-image {
            width: 90%; /* ‡§∏‡•á‡§≤ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§á‡§Æ‡•á‡§ú ‡§∏‡§æ‡§á‡•õ */
            height: 90%;
            object-fit: contain; /* ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§á‡§Æ‡•á‡§ú ‡§∏‡•ç‡§ï‡•ç‡§µ‡•Ä‡§ú ‡§® ‡§π‡•ã */
            transition: transform 0.1s ease-in-out;
        }

        .selected {
            /* ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§π‡§≤‡•ç‡§ï‡§æ ‡§™‡•Ä‡§≤‡§æ ‡§π‡§æ‡§à‡§≤‡§æ‡§á‡§ü (‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§•) */
            background-color: rgba(255, 235, 59, 0.5) !important; 
        }

        .highlight {
            /* ‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§ö‡§æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§∞‡§æ ‡§π‡§æ‡§à‡§≤‡§æ‡§á‡§ü (‡§™‡§æ‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§•) */
            background-color: rgba(165, 214, 167, 0.5) !important; 
        }
        
        #status-message {
            width: 100%;
            text-align: center;
            margin-top: 1vmin;
            font-size: 3vmin;
            font-weight: bold;
            color: #333;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.7); /* ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§≤‡•ç‡§ï‡§æ ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="board">
            </div>
        <div id="status-message">Loading game...</div>
    </div>

    <script>
        /* JavaScript (‡§Ö‡§™‡§°‡•á‡§ü‡•á‡§° ‡§≤‡•â‡§ú‡§ø‡§ï) */
        
        // !!! ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡•Ä GitHub ‡§∞‡•â JSON ‡§≤‡§ø‡§Ç‡§ï ‡§°‡§æ‡§≤‡•á‡§Ç !!!
        const JSON_URL = "https://raw.githubusercontent.com/GOLu496/Files/main/puzzle.json";

        const IMAGE_FILES = {
            'Rook': 'Rook.png',
            'Knight': 'Knight.png',
            'Bishop': 'Bishop.png',
            'King': 'King.png',
            'Star': 'Star.png', 
            'Block': 'Block.jpg',
            'Empty': 'empty.png' // ‡§®‡§Ø‡§æ: ‡§ñ‡§æ‡§≤‡•Ä ‡§∏‡•á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è
        };

        const BOARD_SIZE = 4;
        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('status-message');

        let boardState = []; 
        let selectedSquare = null; 
        let isGameOver = false; // ‡§ó‡•á‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è

        // --- 1. JSON ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ó‡•á‡§Æ ‡§ï‡•ã ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡•õ ‡§ï‡§∞‡•á‡§Ç ---
        async function loadGame() {
            try {
                // ... (JSON fetching code is the same)
                statusElement.textContent = "Fetching game data...";
                const response = await fetch(JSON_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const initialConfig = await response.json();
                
                boardState = Array(BOARD_SIZE).fill(0).map(() => Array(BOARD_SIZE).fill(null));

                initialConfig.pieces.forEach(p => {
                    // ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§ü‡•ã‡§ï‡§® ‡§π‡§Æ‡§æ‡§∞‡•á ‡§™‡§æ‡§∏ ‡§π‡•à ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à
                    if (p.row >= 0 && p.row < BOARD_SIZE && p.col >= 0 && p.col < BOARD_SIZE && IMAGE_FILES[p.piece]) {
                        boardState[p.row][p.col] = p.piece;
                    }
                });

                isGameOver = false;
                renderBoard();
                statusElement.textContent = "Game started! Move the King to the Star to win.";

            } catch (error) {
                console.error("Failed to load game configuration:", error);
                statusElement.textContent = `Error loading game. Check your JSON_URL and internet connection.`;
            }
        }

        // --- 2. ‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡•ã HTML ‡§™‡§∞ ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç (‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§∏‡§æ‡§•) ---
        function renderBoard() {
            boardElement.innerHTML = '';
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const square = document.createElement('div');
                    square.classList.add('square');
                    square.setAttribute('data-row', r);
                    square.setAttribute('data-col', c);
                    square.addEventListener('click', () => handleSquareClick(r, c));

                    const pieceType = boardState[r][c];
                    const imageSource = pieceType ? IMAGE_FILES[pieceType] : IMAGE_FILES['Empty'];
                    
                    // ‡§á‡§Æ‡•á‡§ú ‡§ü‡•à‡§ó ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó
                    const pieceImage = document.createElement('img');
                    pieceImage.classList.add('piece-image');
                    pieceImage.src = imageSource;
                    pieceImage.alt = pieceType || 'Empty';
                    square.appendChild(pieceImage);

                    boardElement.appendChild(square);
                }
            }
            
            // ‡§π‡§æ‡§à‡§≤‡§æ‡§á‡§ü‡•ç‡§∏ (‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§≤‡•â‡§ú‡§ø‡§ï ‡§ï‡•Ä ‡§§‡§∞‡§π)
            if (selectedSquare) {
                const [sR, sC] = selectedSquare;
                const selectedElement = boardElement.querySelector(`[data-row="${sR}"][data-col="${sC}"]`);
                if (selectedElement) selectedElement.classList.add('selected');
                
                const selectedPieceType = boardState[sR][sC];
                for (let r = 0; r < BOARD_SIZE; r++) {
                    for (let c = 0; c < BOARD_SIZE; c++) {
                        if (isValidMove(selectedPieceType, sR, sC, r, c)) {
                            const targetElement = boardElement.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                            if (targetElement) targetElement.classList.add('highlight');
                        }
                    }
                }
            }
        }

        // --- 3. ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§á‡§µ‡•á‡§Ç‡§ü ‡§π‡•à‡§Ç‡§°‡§≤ ‡§ï‡§∞‡•á‡§Ç ---
        function handleSquareClick(row, col) {
            // ‡§ú‡•Ä‡§§ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§ï‡•ã‡§à ‡§ö‡§æ‡§≤ ‡§®‡§π‡•Ä‡§Ç
            if (isGameOver) {
                statusElement.textContent = "Game Over! Refresh to play again.";
                return;
            }
            
            const pieceType = boardState[row][col];
            
            if (selectedSquare) {
                const [sR, sC] = selectedSquare;
                const selectedPieceType = boardState[sR][sC];
                
                // 3a. ‡§ö‡§æ‡§≤ (Move) ‡§ï‡§∞‡•á‡§Ç
                if (isValidMove(selectedPieceType, sR, sC, row, col)) {
                    
                    // Star ‡§™‡§∞ ‡§ú‡§æ‡§®‡§æ: ‡§ú‡•Ä‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö
                    if (boardState[row][col] === 'Star') {
                        // ‡§µ‡§ø‡§® ‡§ï‡§Ç‡§°‡•Ä‡§∂‡§®: ‡§ï‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§∏‡•ç‡§ü‡§æ‡§∞ ‡§™‡§∞ ‡§ú‡§æ‡§®‡§æ ‡§π‡•ã‡§ó‡§æ
                        if (selectedPieceType === 'King') {
                            isGameOver = true;
                            boardState[sR][sC] = null; // King ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§ó‡§π ‡§∏‡•á ‡§π‡§ü‡§æ
                            // Star ‡§™‡§∞ King ‡§ï‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ‡•á‡§Ç Star ‡§ï‡•ã King ‡§∏‡•á ‡§¨‡§¶‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ 
                            // ‡§Ø‡§æ ‡§¨‡•ã‡§∞‡•ç‡§° ‡§∞‡•á‡§Ç‡§°‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§
                            // ‡§∏‡§∞‡§≤‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ King ‡§ï‡•ã Star ‡§∏‡•á‡§≤ ‡§™‡§∞ "‡§∞‡§ñ‡§§‡•á" ‡§π‡•à‡§Ç‡•§
                            boardState[row][col] = 'King_on_Star'; 
                            
                            selectedSquare = null;
                            renderBoard();
                            statusElement.textContent = "üèÜ CONGRATULATIONS! King reached the Star! üèÜ";
                            return; 
                        } 
                        // King ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§§‡•ã ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§æ‡§≤ ‡§ï‡•Ä ‡§§‡§∞‡§π Star ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å
                        else {
                            // King ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞ ‡§ï‡•ã‡§à ‡§≠‡•Ä Star ‡§™‡§∞ ‡§ï‡§¨‡•ç‡§ú‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ
                            // ‡§≤‡•á‡§ï‡§ø‡§® King ‡§ú‡•Ä‡§§ ‡§ú‡§æ‡§è ‡§§‡•ã Star ‡§™‡§∞ King ‡§ï‡•Ä ‡§á‡§Æ‡•á‡§ú ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä‡•§
                            // ‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•ã‡§ï‡§® Star ‡§™‡§∞ ‡§ú‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§î‡§∞ King ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§µ‡§π‡§æ‡§Å ‡§ï‡§¨‡•ç‡§ú‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•á, 
                            // ‡§µ‡•á Star ‡§ï‡•ã ‡§π‡§ü‡§æ‡§§‡•á ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç (‡§™‡§ø‡§õ‡§≤‡•á ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§™‡§∞‡•Ä‡§§)
                            
                            // King ‡§ï‡•Ä ‡§ú‡•Ä‡§§ ‡§ï‡•á ‡§¨‡§æ‡§¶ Star ‡§ï‡•ã King_on_Star ‡§∏‡•á ‡§¨‡§¶‡§≤‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§ ‡§á‡§∏‡•á ‡§∏‡§Ç‡§≠‡§æ‡§≤‡•á‡§Ç
                            if(boardState[row][col] === 'King_on_Star') {
                                // ‡§Ö‡§ó‡§∞ Star ‡§™‡§∞ King ‡§π‡•à, ‡§§‡•ã ‡§ï‡•ã‡§à ‡§î‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ
                                return;
                            }
                            
                            // ‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•ã‡§ï‡§® Star ‡§ï‡•Ä ‡§ú‡§ó‡§π (Star.png) ‡§™‡§∞ ‡§ñ‡§°‡§º‡•á ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç 
                            // ‡§î‡§∞ Star ‡§µ‡§æ‡§™‡§∏ ‡§Ü ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡§¨ ‡§µ‡•á ‡§π‡§ü‡§§‡•á ‡§π‡•à‡§Ç‡•§
                            // ‡§á‡§∏‡•á ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ‡•§
                            
                            // ‡§∏‡§∞‡§≤ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®: Star ‡§è‡§ï ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ñ‡§æ‡§≤‡•Ä ‡§∏‡•á‡§≤ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§¨‡§∞‡•ç‡§§‡§æ‡§µ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à 
                            // (‡§ú‡§¨ King ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•ã‡§à ‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•ã‡§ï‡§® ‡§â‡§∏ ‡§™‡§∞ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à)
                            
                            // King ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•ã‡§à ‡§ü‡•ã‡§ï‡§® Star ‡§™‡§∞ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, Star ‡§ï‡•ã ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡§ü‡§æ ‡§¶‡•á‡§Ç (null)
                            boardState[sR][sC] = null;
                            boardState[row][col] = selectedPieceType; // ‡§ü‡•ã‡§ï‡§® Star ‡§ï‡•Ä ‡§ú‡§ó‡§π ‡§™‡§∞ ‡§ö‡§≤‡§æ ‡§ó‡§Ø‡§æ
                            
                            selectedSquare = null;
                            renderBoard();
                            statusElement.textContent = `Moved ${selectedPieceType} to the Star location.`;
                            return;
                        }
                    }

                    // ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ö‡§æ‡§≤ (Star ‡§∏‡•á ‡§π‡§ü‡§®‡§æ ‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§ñ‡§æ‡§≤‡•Ä/‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•ã‡§ï‡§® ‡§™‡§∞ ‡§ú‡§æ‡§®‡§æ)
                    boardState[row][col] = selectedPieceType;
                    boardState[sR][sC] = null; // ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§ú‡§ó‡§π ‡§ñ‡§æ‡§≤‡•Ä
                    
                    selectedSquare = null;
                    renderBoard();
                    statusElement.textContent = `Moved ${selectedPieceType}. Your turn.`;
                } 
                // 3b. ‡§°‡•Ä-‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§Ø‡§æ ‡§®‡§Ø‡§æ ‡§ü‡•ã‡§ï‡§® ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
                else {
                    selectedSquare = null;
                    if (pieceType && isMovable(pieceType)) {
                        selectPiece(row, col);
                    } else {
                        renderBoard(); 
                    }
                }
            } 
            // 3c. ‡§ü‡•ã‡§ï‡§® ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç 
            else if (pieceType && isMovable(pieceType)) {
                selectPiece(row, col);
            }
        }

        // --- 4. ‡§ü‡•ã‡§ï‡§® ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ---
        function selectPiece(row, col) {
            selectedSquare = [row, col];
            renderBoard(); 
        }

        // --- 5. ‡§®‡§ø‡§Ø‡§Æ ‡§î‡§∞ ‡§Æ‡•Ç‡§µ ‡§≤‡•â‡§ú‡§ø‡§ï ---

        function isMovable(pieceType) {
            return pieceType !== 'Star' && pieceType !== 'Block' && pieceType !== 'King_on_Star';
        }

        function isValidMove(pieceType, startR, startC, endR, endC) {
            if (startR === endR && startC === endC) return false;
            
            const targetPiece = boardState[endR][endC];
            
            // Rule: Block ‡§™‡§∞ ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ
            if (targetPiece === 'Block') return false;
            
            // Rule: King ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞ ‡§ï‡•ã‡§à ‡§≠‡•Ä Star ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡§æ (Star ‡§™‡§∞ ‡§ú‡§æ‡§®‡•á ‡§™‡§∞)
            if (pieceType !== 'King' && targetPiece === 'Star') {
                 // Star ‡§™‡§∞ ‡§ú‡§æ‡§®‡§æ ‡§§‡§≠‡•Ä ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à ‡§ú‡§¨ ‡§µ‡§π ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•ã, ‡§Ø‡§æ Star ‡§π‡•ã‡•§
                 // ‡§Ö‡§ó‡§∞ Star ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏ ‡§™‡§∞ ‡§ú‡§æ‡§®‡§æ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§π‡•à‡•§ 
            }
            
            // Rule: King ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•ã‡§à ‡§≠‡•Ä Star ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§î‡§∞ ‡§ü‡•ã‡§ï‡§® ‡§™‡§∞ ‡§ï‡§¨‡•ç‡§ú‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ
            if (targetPiece !== null && targetPiece !== 'Star' && targetPiece !== 'Block') return false;
            
            // ‡§Ö‡§ó‡§∞ Star ‡§™‡§∞ King ‡§π‡•à (‡§ú‡•Ä‡§§ ‡§ï‡•á ‡§¨‡§æ‡§¶), ‡§§‡•ã ‡§ï‡•ã‡§à ‡§î‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ
            if (targetPiece === 'King_on_Star') return false;


            const dr = Math.abs(endR - startR);
            const dc = Math.abs(endC - startC);

            switch (pieceType) {
                case 'King':
                    return dr <= 1 && dc <= 1;

                case 'Rook':
                    if (dr === 0 || dc === 0) {
                        return !isPathBlocked(startR, startC, endR, endC);
                    }
                    return false;

                case 'Bishop':
                    if (dr === dc) {
                        return !isPathBlocked(startR, startC, endR, endC);
                    }
                    return false;

                case 'Knight':
                    return (dr === 2 && dc === 1) || (dr === 1 && dc === 2);
                    
                default:
                    return false;
            }
        }

        // ‡§∞‡§æ‡§∏‡•ç‡§§‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§µ‡§∞‡•ã‡§ß‡§ï ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö (Rook ‡§î‡§∞ Bishop ‡§ï‡•á ‡§≤‡§ø‡§è)
        function isPathBlocked(startR, startC, endR, endC) {
            const rStep = Math.sign(endR - startR);
            const cStep = Math.sign(endC - startC);
            
            let r = startR + rStep;
            let c = startC + cStep;
            
            while (r !== endR || c !== endC) {
                const piece = boardState[r][c];
                // Block ‡§Ø‡§æ ‡§ï‡•ã‡§à ‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•ã‡§ï‡§® ‡§∞‡§æ‡§∏‡•ç‡§§‡•á ‡§ï‡•ã ‡§¨‡•ç‡§≤‡•â‡§ï ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
                if (piece !== null && piece !== 'Star') {
                    return true;
                }
                r += rStep;
                c += cStep;
            }
            return false;
        }

        // ‡§ó‡•á‡§Æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
        loadGame();
    </script>
</body>
</html>
